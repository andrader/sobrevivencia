---
title: "MAE0514 - Introducão a Análise de Sobrevivência - Lista 3"
author: |
  | Bruno de Castro Paul Schultze\thanks{Número USP: 10736862}
  | Rubens Santos Andrade Filho\thanks{Número USP: 10370336}
date: "`r stringr::str_to_sentence(format(Sys.time(), '%B de %Y'))`"
lang: pt-BR
header-includes:
  # - \usepackage[brazilian]{babel} # ja usando lang: pt-BR
  - \usepackage{float}
  - \usepackage{amsmath}
  - \usepackage{amsthm}
  - \floatplacement{figure}{H}
  - \usepackage{indentfirst}
  - \setlength{\parindent}{4em}
  - \setlength{\parskip}{1em}
  - \usepackage{booktabs}
  - \usepackage{dcolumn}
  - \usepackage{bm}
  - \usepackage{titling}
  - \thanksmarkseries{arabic} % \thanks footnotes com numeros
  - \usepackage[bottom]{footmisc} % corrige posição footnotes
  - \usepackage{grffile}
  - \usepackage{pdfpages}
  - \usepackage{tocloft}
  - \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
  - \usepackage{amssymb}
  - \renewcommand\qedsymbol{$\blacksquare$}
  - \usepackage{pdfpages}
  - \usepackage{cleveref}
  - \usepackage{threeparttable}
output:
  pdf_document: 
    fig_caption: yes
    number_sections: no
    toc: true
    toc_depth: 3
---

\pagebreak

\newcommand\invisiblesection[1]{%
  \refstepcounter{section}%
  \addcontentsline{toc}{section}{#1}%
  \sectionmark{#1}}

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, 
                      # fig.dim = c(5,5),
                      # out.height = '40%',
                      # fig.align = 'center',
                      message=FALSE
                      )

library(tidyverse)
library(ggplot2)
library(knitr)
library(readr)
library(dplyr)


```

\clearpage

# Questão 1

# Questão 2

# Questão 3

# Questão 4 

## 4.a

```{r, include = FALSE}
# QUESTAO 4 ----
# QUESTAO 4a ----
library(survival)
library(survminer)
df = read.table('data/Lista3_whas500.dat')
colnames(df) = c('id','age','gender', 'hr', 'sysbp', 'diasbp', 'bmi','cvd',
                 'afb','sho','chf','av3','miord', 'mitype', 'year', 
                 'admitdate', 'disdate', 
                 'fdate', 'los', 'dstat', 'lenfol', 'fstat')
df =  df[,c('lenfol', 'fstat', 'age', 'hr', 'diasbp', 'chf')]
```

Primeiro vamos dividir a variável Idade segundo as faixas propostas pelo enunciado, e as outras variáveis contínuas vamos dividir entre:

* Menor que o primeiro quartil
* Entre o primeiro e o segundo quartis
* Entre o segundo e o terceiro quartis
* Maior que o terceiro quartil

```{r, include=FALSE}

# criando faixas de idade
df$faixa_idade <- as.factor(sapply(df$age,
  function(x){
  if (x < 60) x = '60<'
  else if (x >= 60 & x < 75) x = '>=60 & 75<'
  else if (x >= 75 ) x = '>=75'
  }))

quantile(df$diasbp, probs = 0.25)

df$faixa_hr <- as.factor(sapply(df$hr,
  function(x){
  if (x < quantile(df$hr, probs = 0.25)) x = '[0,Q1['
  else if (x >= quantile(df$hr, probs = 0.25) & 
           x < quantile(df$hr, probs = 0.50)) x = '[Q1, Q2['
  else if (x >= quantile(df$hr, probs = 0.50) & 
           x < quantile(df$hr, probs = 0.75)) x = '[Q2, Q3['
  else if (x>=quantile(df$hr, probs = 0.75)) x = "[Q3, inf["
  }))


df$faixa_diasbp <- as.factor(sapply(df$diasbp,
  function(x){
  if (x < quantile(df$diasbp, probs = 0.25)) x = '[0,Q1['
  else if (x >= quantile(df$diasbp, probs = 0.25) & 
           x < quantile(df$diasbp, probs = 0.50)) x = '[Q1, Q2['
  else if (x >= quantile(df$diasbp, probs = 0.50) & 
           x < quantile(df$diasbp, probs = 0.75)) x = '[Q2, Q3['
  else if (x>=quantile(df$diasbp, probs = 0.75)) x = "[Q3, inf["
  }))
```

# Questão 5

Considerando os dados do exercício 4,

(a) Refizemos o item (b) utilizando a distribuição log-logística. Especifique claramente qual foi o modelo utilizado e quais foram os parâmetros estimados.

```{r}
# QUESTAO 5 ----

library(survival)
library(survminer)
df = read.table('data/Lista3_whas500.dat')

# QUESTAO 5a ----



```


(b) Encontre uma estimativa pontual para ao fator de aceleração para as variáveis idade categorizada e complicações congestivas e interprete o resultado.
(c) A chance de sobrevivência após $t$ é definida como
$$
\frac{S(t \mid x)}{1-S(t \mid x)}
$$
No modelo logístico, mostre que
$$
\frac{S(t \mid x)}{1-S(t \mid x)}=\exp \left[-\boldsymbol{\beta}^{T} \boldsymbol{x}\right] \frac{S(t \mid \boldsymbol{x}=\mathbf{0})}{1-S(t \mid \boldsymbol{x}=\mathbf{0})}
$$
(d) Obtenha uma estimativa da razão de chances de sobrevivência após $t$ de pacientes sem complicações congestivas e com complicações congestivas. Interprete.

# Questão 6

# Código Completo

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```
